## Command-Line Interface (CLI) Management
link

The [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) command-line interface provides the primary means for users to interact with and manage the AI agent system. Its functionality includes an interactive setup process, diagnostic tools for environment health, runtime management of AI tasks, and a mechanism for displaying version information. The CLI is designed to simplify the integration of [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) into existing [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) environments and to provide essential tools for maintaining and troubleshooting the system.
The core of the CLI's operations is managed by the [`src/cli`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli) directory. This directory contains the logic for handling various commands, ensuring that users can easily install the system, run AI-driven tasks, and verify the health of their setup.
The [`install`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/install.ts#L351) command, implemented in [`src/cli/install.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/install.ts), guides users through the initial setup. This process can be interactive, using a Text User Interface (TUI), or non-interactive for automated deployments. During installation, the CLI configures [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) by integrating the [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) plugin, setting up authentication plugins for various AI providers (such as Claude, ChatGPT, and Gemini), and defining their model specifications. This configuration management ensures that the system is correctly set up to use the selected AI models. The CLI's configuration manager, found in [`src/cli/config-manager.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/config-manager.ts), is responsible for reading, updating, and writing configuration files, including handling JSONC formats to preserve user comments.
For maintaining system health, the [`doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/index.ts#L4) command, located within the [`src/cli/doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor) directory, performs a suite of diagnostic checks. These checks cover critical areas such as authentication status, validity of configuration files, presence of external command-line tools and Node.js NAPI modules, GitHub CLI installation, Language Server Protocol (LSP) servers, and Model Context Protocol (MCP) servers. The [`doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/index.ts#L4) command aggregates the results of these checks, providing a summary of the system's health and suggesting remedies for any detected issues. This diagnostic capability is essential for troubleshooting and ensuring that the [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) environment is fully operational. See [Health Diagnostics and Environment Checks](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#health-diagnostics-and-environment-checks) for a detailed explanation of the diagnostic process.
The [`run`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/run/runner.ts#L10) command, orchestrated by the [`src/cli/run`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/run) directory, manages the execution of AI agent tasks. This command initiates and supervises [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) sessions, processing event streams from the AI agents and monitoring for task completion. It handles potential timeouts and interruptions, ensuring that AI-driven tasks are executed and managed effectively within the CLI environment. The system determines task completion based on the status of "Todo" items and the idleness of descendant sessions, providing clear indicators of progress and successful execution.
Finally, the [`get-local-version`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/index.ts#L5) command, found in [`src/cli/get-local-version`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/get-local-version), provides information about the installed plugin's version. This command checks whether the plugin is running in local development mode, if it's pinned to a specific version, or if updates are available. It presents this information in a clear, formatted output, enabling users to keep track of their [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) installation's status.
### CLI Installation and Configuration
link

The [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) CLI provides an [`install`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/install.ts#L351) command for integrating with an [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) environment. This command supports both interactive (TUI) and non-interactive command-line installations, allowing users to configure AI model providers like Claude, ChatGPT, and Gemini. The installation process involves detecting existing [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) configurations, validating installation arguments, and verifying the [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) installation itself.
The [`install`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/install.ts#L351) command modifies [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54)'s configuration files by adding the [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) plugin, as well as authentication plugins ([`opencode-antigravity-auth`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L312), [`opencode-openai-codex-auth`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L360)) and provider-specific settings for AI models. For example, it can configure model specifications for Google's Gemini models, including their context and output limits and supported modalities. A ChatGPT hotfix can also be applied to ensure compatibility. The process concludes by generating and writing the [`oh-my-opencode.json`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L330) configuration, which maps agent names to specific models and merges with existing settings to avoid data loss.
The core logic for configuration management, including parsing JSONC files, adding plugins, and handling provider configurations, resides in [`addPluginToOpenCodeConfig`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/config-manager.ts#L137) and [`addProviderConfig`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/config-manager.ts#L547) within [`src/cli/config-manager.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/config-manager.ts). This manager also includes utilities for [`bun install`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L255) execution to manage dependencies and [`detectCurrentConfig`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/config-manager.ts#L595) to identify which features and integrations are currently active.
Upon completion, the installer provides a summary of the configured settings and guidance for subsequent authentication steps. The [`InstallArgs`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/types.ts#L4) and [`InstallConfig`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/types.ts#L12) types, defined in [`src/cli/types.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/types.ts), ensure type safety and clarity for installation arguments and configurations. For more details on the CLI's overall functionality, refer to [Command-Line Interface (CLI) Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#command-line-interface-cli-management).
### CLI Health Diagnostics and Environment Checks
link

The [`doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/index.ts#L4) command within the Command-Line Interface (CLI) provides a diagnostic tool to assess the health and configuration of the [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) application and its operating environment. It performs a series of checks covering various aspects, including authentication provider configurations, application configuration validity, external CLI tool presence and versions, GitHub CLI status, Language Server Protocol (LSP) and Micro-Agent Compute Protocol (MCP) server configurations, [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) CLI installation, plugin registration, and application version status.
The diagnostic process is orchestrated by a runner that retrieves, filters, and groups these checks before executing them asynchronously. The execution measures the duration of each check and handles potential errors, reporting them as a "fail" status. After all checks are completed, the system calculates a summary of passed, failed, warned, and skipped checks and determines an appropriate CLI exit code. The results can be presented in a human-readable console output or a machine-readable JSON format.
A comprehensive suite of diagnostic checks is available, implemented as individual modules within the [`src/cli/doctor/checks`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks) directory. For example, authentication checks in [`src/cli/doctor/checks/auth.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/auth.ts) verify the installation and configuration of authentication provider plugins like Anthropic, OpenAI, and Google. Configuration checks in [`src/cli/doctor/checks/config.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/config.ts) ensure the application's configuration files are present and valid. Dependency checks in [`src/cli/doctor/checks/dependencies.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/dependencies.ts) confirm the presence and version of external tools such as [`AST-Grep CLI`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L195) and [`Comment Checker`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L180).
The [`doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/index.ts#L4) command also includes checks for the GitHub CLI ([`gh`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L429)), LSP servers, and MCP servers, ensuring that these external components are correctly configured and accessible. Checks in [`src/cli/doctor/checks/opencode.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/opencode.ts) validate the [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) CLI installation and version, while plugin registration checks in [`src/cli/doctor/checks/plugin.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/plugin.ts) confirm that the main application plugin is properly configured. Finally, version status checks in [`src/cli/doctor/checks/version.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/version.ts) assess the application's current version against the latest available, providing information on updates. For more information on the execution and orchestration of these checks, see [Diagnostic Check Execution and Orchestration](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#health-diagnostics-and-environment-checks-diagnostic-check-execution-and-orchestration). The individual checks are further detailed in [Comprehensive Suite of Diagnostic Checks](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#health-diagnostics-and-environment-checks-comprehensive-suite-of-diagnostic-checks). Output formatting is managed to provide clear and actionable insights, as described in [Output Formatting and Presentation](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#health-diagnostics-and-environment-checks-output-formatting-and-presentation).
### CLI Runtime Session Management
link

The [`run`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/run/runner.ts#L10) command orchestrates the execution of AI agent tasks within the [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) command-line interface. This process involves managing [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) sessions, handling event streams from these sessions, responding to timeouts and interruptions, and determining when a task has completed.
Execution begins by initializing an [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) client and server. An [`AbortController`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/run/types.ts#L14) is configured to manage overall execution time limits and to allow for graceful termination in response to user interruptions like [`Ctrl+C`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/client.ts#L43). Once a new [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) session is established, the initial prompt is sent to the AI agent.
The system then enters a polling loop that continuously monitors the session's progress. This loop processes incoming events from the [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) server, which can include updates on session status, message parts, tool executions, and errors. These events are handled by dedicated processors that update the session's internal state and provide real-time feedback to the user via the console.
Task completion is determined based on two primary conditions: all designated "Todo" items for the current session must be marked as "completed" or "cancelled", and all descendant sessions (sub-sessions spawned by the main task) must be in an "idle" state. The system recursively checks the status of child sessions to ensure that all sub-tasks have also concluded before declaring the main task complete.
This orchestration ensures that AI agent tasks are managed throughout their lifecycle, from initiation to completion, while providing robust error handling, interruption management, and clear user feedback. For a broader understanding of the CLI's capabilities, refer to [Command-Line Interface (CLI) Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#command-line-interface-cli-management).
### CLI Version Information and Status
link

The [`get-local-version`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/index.ts#L5) command provides a mechanism for users to retrieve and display detailed version information about the [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) plugin. This command is designed to offer a quick overview of the plugin's status, indicating whether it's running in local development mode, pinned to a specific version, up-to-date with the latest release, or outdated. The command is invoked via the CLI, as described in [Command-Line Interface (CLI) Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#command-line-interface-cli-management).
The command's primary function, [`getLocalVersion`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/get-local-version/index.ts#L5) in [`src/cli/get-local-version/index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/get-local-version/index.ts), determines the plugin's version status through a series of checks. It first ascertains if the plugin is in a local development environment. If not, it checks for a pinned version, which indicates a deliberate choice to use a specific, unchangeable version. Subsequently, it retrieves the currently installed version and compares it against the latest available version to determine if an update is needed. If no version can be determined, the status defaults to "unknown".
The output of the [`get-local-version`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/index.ts#L5) command can be presented in two formats. By default, it provides a human-readable, color-coded text output, enhancing clarity and user experience, as handled by the [`formatVersionOutput`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/get-local-version/formatter.ts#L14) function in [`src/cli/get-local-version/formatter.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/get-local-version/formatter.ts). Alternatively, users can opt for a JSON output format, which is particularly useful for programmatic consumption or integration with other tools. This serialization is managed by [`formatJsonOutput`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/formatter.ts#L82) in the same file. The [`VersionInfo`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/get-local-version/types.ts#L1) interface, defined in [`src/cli/get-local-version/types.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/get-local-version/types.ts), structures the comprehensive version details, ensuring consistency in data representation.
