## Configuration Management
link

The system centralizes the definition and management of configuration schemas and types, facilitating runtime validation and static type inference across various configuration objects. This includes agent overrides, skill definitions, and feature settings for components such as the [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) orchestrator and dynamic context pruning mechanisms.
Configuration schemas are primarily defined using the Zod library within the [`src/config/schema.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts) file. This approach ensures that all configuration objects adhere to predefined structures and validation rules at runtime, while also automatically generating TypeScript types for compile-time type safety. Key aspects covered by these schemas include:
  * **Permissions:** Granular control over agent actions such as [`edit`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/oracle.ts#L106), [`bash`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L49), [`webfetch`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L87), [`doom_loop`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L866), and [`external_directory`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L867) is defined, allowing for flexible configuration of agent capabilities through [`AgentPermissionSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L11).
  * **Agent Overrides:** Detailed customization of agent behaviors is supported via [`AgentOverrideConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L84), including properties like [`model`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L102), [`temperature`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/oracle.ts#L105), [`prompt`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/index.ts#L269), [`tools`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/explore.ts#L33), [`disable`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L330), [`description`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/skill/tools.ts#L129), [`mode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/install.ts#L65), [`color`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/install.ts#L28), and specific [`permission`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-handlers/config-handler.ts#L155) settings.
  * **Feature-Specific Configurations:** Dedicated schemas manage settings for various functionalities, including [`SisyphusAgentConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L125), [`CommentCheckerConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L132), [`DynamicContextPruningConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L137), and [`RalphLoopConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L226). For example, [`DynamicContextPruningConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L137) defines strategies such as deduplication, superseding writes, and purging errors to manage context window usage.
  * **Skill Definitions:** The structure of AI agent skills is managed through [`SkillDefinitionSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L197), encompassing elements like [`description`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/skill/tools.ts#L129), [`template`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/hooks/auto-slash-command/executor.ts#L183), [`model`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L102), [`agent`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/index.ts#L72), [`subtask`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/slashcommand/types.ts#L9), [`argument-hint`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L204), and [`allowed-tools`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L208).

The [`src/config/index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/index.ts) file serves as a central point for re-exporting these schemas and their inferred TypeScript types. This design simplifies imports for other parts of the codebase, enhancing overall organization and maintainability by providing a single, consistent interface for configuration definitions.
Plugin-provided configurations are integrated and managed by the [`plugin-handlers`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/index.ts#L60) module, specifically through the [`createConfigHandler`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-handlers/config-handler.ts#L33) function defined in [`src/plugin-handlers/config-handler.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-handlers/config-handler.ts). This handler initializes, merges, and manages configurations for agents, commands, skills, and model providers. It combines built-in functionalities with user-defined and plugin-provided extensions, applying overrides and setting tool access permissions. This dynamic loading and merging process ensures that the operational environment is configured correctly, adapting to user preferences and plugin capabilities. For more details on how plugins are integrated and configured, refer to [Plugin Integration and Configuration Flow](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-orchestration-and-core-system-plugin-integration-and-configuration-flow).
### Schema Definition and Type Inference
link

The system utilizes Zod for defining comprehensive configuration schemas, which enables both runtime validation and static TypeScript type inference for various application configurations. This approach ensures that configuration objects are well-structured and type-safe throughout the application. For instance, permissions for agent actions are defined using [`AgentPermissionSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L11), which provides granular control over functionalities like [`edit`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/oracle.ts#L106), [`bash`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L49), [`webfetch`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L87), and [`external_directory`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L867) access.
Naming conventions for built-in components such as agents, skills, and hooks are enforced through schemas like [`BuiltinAgentNameSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L19) and [`HookNameSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L49), ensuring consistency and valid references. Agent behaviors can be customized via [`AgentOverrideConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L84), allowing adjustments to properties such as [`model`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L102), [`temperature`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/oracle.ts#L105), and [`prompt`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/index.ts#L269).
Feature-specific configurations, including those for ClaudeCode, Sisyphus agents, and dynamic context pruning strategies, each have dedicated schemas to manage their unique settings. The [`DynamicContextPruningConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L137), for example, defines how strategies like [`deduplication`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L156) and [`supersede_writes`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L160) are configured to prevent token overflows. Skill definitions are structured using [`SkillDefinitionSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L197), detailing aspects such as [`description`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/skill/tools.ts#L129), [`template`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/hooks/auto-slash-command/executor.ts#L183), and [`allowed-tools`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L208). The [`OhMyOpenCodeConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L235) serves as the top-level schema, consolidating all other configuration schemas into a complete application configuration structure.
All these schemas, and their inferred TypeScript types, are re-exported through the file [`src/config/index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/index.ts). This centralizes configuration definitions and simplifies imports across the codebase, contributing to maintainability. The file [`src/config/schema.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts) is where the detailed schema definitions are implemented using Zod, providing a structured and validated approach to managing application settings. For further details on how these configurations are managed across the application, refer to [Centralized Configuration Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#configuration-management-centralized-configuration-management).
### Centralized Configuration Management
link

The [`src/config`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/AGENTS.md?plain=1#L39) directory serves as a central repository for defining and organizing configuration schemas and types within the [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) application. This centralization ensures consistent structure, type safety, and runtime validation for various configuration objects throughout the system.
The core of this management strategy is the use of the [`z`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/mcp/types.ts#L1) (Zod) library, which allows for the definition of schemas that dictate the structure, validation rules, and inferred TypeScript types for configurations. This includes schemas for:
  * Permissions, such as [`AgentPermissionSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L11), which controls agent actions like [`edit`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/oracle.ts#L106) or [`bash`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L49).
  * Naming conventions for built-in components, ensuring valid names for agents, skills, and hooks.
  * Agent overrides, enabling customization of agent behaviors, including model, temperature, and permissions, via [`AgentOverrideConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L84).
  * Feature-specific configurations for components like [`ClaudeCodeConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L115), [`SisyphusAgentConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L125), and [`DynamicContextPruningConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L137), which manages context window recovery strategies.
  * Skill definitions, outlining the structure of individual skills and their associated properties through [`SkillDefinitionSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L197).

The directory's [`index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/AGENTS.md?plain=1#L25) file acts as a barrel file, consolidating all these schemas and their inferred TypeScript types. This approach simplifies imports for other parts of the codebase, enhancing organization and maintainability by providing a single point of access for all configuration-related definitions. By leveraging Zod, the system benefits from runtime validation and static type inference, promoting a robust and type-safe approach to configuration management. For how these configurations are integrated and managed across various plugins, refer to [Plugin Integration and Configuration Flow](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-orchestration-and-core-system-plugin-integration-and-configuration-flow) and [Plugin-Provided Configuration Integration](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#configuration-management-plugin-provided-configuration-integration).
### Plugin-Provided Configuration Integration
link

The [`plugin-handlers`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/index.ts#L60) module, primarily encapsulated by [`createConfigHandler`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-handlers/config-handler.ts#L33) in [`src/plugin-handlers/config-handler.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-handlers/config-handler.ts), is responsible for initializing, merging, and managing the various configurations that define the behavior of the AI agent system. This includes agents, commands, skills, and model providers. The handler integrates built-in functionalities with user-defined and plugin-provided extensions to establish a cohesive operational environment.
The process begins by loading all plugin components, including commands, skills, agents, Message Context Protocol (MCP) servers, and hooks. This loading respects any [`enabledPluginsOverride`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/features/claude-code-plugin-loader/types.ts#L209) settings, allowing for dynamic control over which plugins are active. Once loaded, the module proceeds to configure agents by initializing built-in agents and then incorporating user, project, and plugin-defined agents. This merging process prioritizes configurations from user, project, and plugin sources over built-in definitions, enabling extensive customization. Specific agents like [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) are configured with their default descriptions, prompts, and permissions based on [`pluginConfig`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/index.ts#L63) settings. See [Orchestrator Agent: Sisyphus](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-definitions-and-architecture-orchestrator-agent-sisyphus) for more details.
Tool configurations are also managed, with agent-specific adjustments. For example, some tools, like [`grep_app_*`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-handlers/config-handler.ts#L203), are globally disabled but selectively enabled for particular agents, such as the [`librarian`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L18) agent. Permissions, such as [`webfetch`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L87) and [`external_directory`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L867), are set globally to "allow". Similarly, MCP server configurations are loaded and merged, combining built-in MCPs with those provided by plugins. See [Micro-Component Providers (MCPs)](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#micro-component-providers-mcps) for more information.
Finally, the module handles command and skill configurations, loading built-in commands and skills alongside those defined by users, projects, and OpenCode global settings. All these loaded components, including those from plugins, are then merged into a unified configuration object. This modular approach, with distinct loading functions for various components, ensures reusability, maintainability, and flexible feature management through conditional loading and configuration merging strategies. For a broader understanding of how all configurations are managed, refer to [Centralized Configuration Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#configuration-management-centralized-configuration-management).
