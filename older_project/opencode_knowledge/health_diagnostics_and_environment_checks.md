## Health Diagnostics and Environment Checks
link

The [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) application includes a "doctor" command-line utility for diagnosing the health and configuration of its environment, leveraging the directory [`src/cli/doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor). This utility performs a series of comprehensive checks to ensure that all necessary components, configurations, and external dependencies are correctly set up. It covers aspects ranging from authentication provider configurations and application configuration validity to the presence and versions of external CLI tools, Language Server Protocol (LSP) servers, and Micro-Component Providers (MCP) servers. The system also verifies plugin registration and the overall application version status, providing a holistic view of the system's operational readiness.
The diagnostic process orchestrates the execution of these checks, aggregates their results, and provides a summary. This orchestration involves retrieving all defined checks, optionally filtering them by category based on user input, and then grouping them for logical presentation. Each check is executed asynchronously, with its duration measured, and any errors encountered are reported as failures. An overall summary is calculated, detailing the counts of passed, failed, warned, and skipped checks. Based on these results, an appropriate exit code is determined, which is particularly useful for integration into automated scripts or CI/CD pipelines.
The output of the diagnostic tool is formatted for clarity, presenting results in a human-readable console format with colored status symbols and detailed messages. It also offers the option to output results in a machine-readable JSON format for programmatic consumption. This dual-output capability supports both direct user troubleshooting and automated system health monitoring. The system further enhances usability by extracting actionable suggestions from failed checks, guiding users on how to resolve identified issues. For more details on the command-line interface itself, refer to [Command-Line Interface (CLI) Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#command-line-interface-cli-management).
### Diagnostic Check Execution and Orchestration
link

The execution runner orchestrates the [`doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/index.ts#L4) command's diagnostic process, managing the retrieval, filtering, and grouping of various checks before their asynchronous execution. The core logic resides in the [`runDoctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/runner.ts#L83) function in [`src/cli/doctor/runner.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/runner.ts), which gathers [`CheckDefinition`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/types.ts#L21) objects using [`getAllCheckDefinitions`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/index.ts#L22) from [`src/cli/doctor/checks/index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/index.ts). These definitions can be filtered by [`CheckCategory`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/types.ts#L13) based on user options and then organized into logical groups according to a predefined order.
Each individual check is executed asynchronously, and its duration is measured. The system incorporates robust error handling, reporting any issues as a "fail" status within a [`CheckResult`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/types.ts#L3). Following the execution of all checks, [`calculateSummary`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/runner.ts#L36) aggregates the results, providing counts of passed, failed, warnings, and skipped checks, along with the total duration of the diagnostic process. This summary is then used by [`determineExitCode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/runner.ts#L47) to produce a standard command-line exit code (0 for success or warnings, 1 for failures), which is particularly useful for integration into automated scripts or continuous integration/continuous delivery (CI/CD) pipelines. Output formatting, managed by [`src/cli/doctor/formatter.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/formatter.ts), presents these results in a human-readable console format or as machine-readable JSON, depending on the specified options. For a detailed breakdown of the various diagnostic checks performed, refer to [Comprehensive Suite of Diagnostic Checks](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#health-diagnostics-and-environment-checks-comprehensive-suite-of-diagnostic-checks). The constants and types defining the structure of these checks and results are outlined in [`src/cli/doctor/constants.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/constants.ts) and [`src/cli/doctor/types.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/types.ts).
### Comprehensive Suite of Diagnostic Checks
link
Category | Description | Primary Files  
---|---|---  
Authentication | Checks for installed and configured authentication plugins for various providers (Anthropic, OpenAI, Google). | `auth.ts`  
Application Configuration | Validates the `opencode.json` or `opencode.jsonc` configuration file. | `config.ts`  
Dependencies | Checks for the presence and version of optional external tools like AST-Grep CLI, AST-Grep NAPI, and Comment Checker. | `dependencies.ts`  
GitHub CLI | Verifies GitHub CLI installation, authentication status, and acquired scopes. | `gh.ts`  
Language Server Protocols (LSP) | Detects the installation status of common LSP servers (TypeScript, Pyright, Rust Analyzer, Gopls). | `lsp.ts`  
MCP Servers | Checks for enabled built-in and user-defined MCP (Multi-Agent Communication Protocol) servers and their configuration validity. | `mcp.ts`  
OpenCode Installation | Verifies the `opencode` CLI installation and checks if its version meets the minimum requirements. | `opencode.ts`  
Plugin Registration | Confirms that the current plugin is correctly registered in the `opencode` configuration file. | `plugin.ts`  
Updates | Determines the current and latest version of the plugin and checks if an update is available. | `version.ts`  
The system incorporates a comprehensive suite of diagnostic checks designed to assess the health and configuration of various components. These checks are orchestrated and executed by a [`doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/index.ts#L4) command-line utility, which groups checks into categories and provides detailed reports.
One set of checks focuses on **authentication provider configurations** , ensuring that necessary plugins are installed and properly configured for services like Anthropic, OpenAI, and Google. These checks verify the presence of authentication plugins within the [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) configuration and indicate if any are missing or incorrectly set up. For instance, [`getAuthProviderInfo`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/auth.ts#L35) and [`checkAuthProvider`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/auth.ts#L50) within [`src/cli/doctor/checks/auth.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/auth.ts) provide functions to read the [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) configuration, determine if a plugin is installed, and generate a diagnostic result based on its findings.
**Application configuration validity** is another key area. The system scans for configuration files in both project-specific and user-level directories, parses them (supporting JSON and JSONC formats), and validates their content against a predefined schema. This ensures that the application operates with a correctly structured and meaningful configuration. The [`getConfigInfo`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/config.ts#L49) and [`checkConfigValidity`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/config.ts#L83) functions in [`src/cli/doctor/checks/config.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/config.ts) are responsible for locating these files, validating their content, and reporting any errors.
Checks are also performed for **external CLI tool presence and versions** , covering essential dependencies like [`AST-Grep`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L195) (for structural code analysis) and [`Comment Checker`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L180). These diagnostics confirm that required binaries are available in the system's [`PATH`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L137) and, in some cases, verify their versions. The [`checkAstGrepCli`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/dependencies.ts#L32) and [`checkCommentChecker`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/dependencies.ts#L81) functions in [`src/cli/doctor/checks/dependencies.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/dependencies.ts) include logic to check for the existence and version of these binaries.
The **GitHub CLI (gh) status** is assessed to confirm its installation, version, and authentication status. This includes verifying if a user is logged in and what OAuth scopes have been granted, which is critical for operations interacting with GitHub. Details on how this is performed can be found through [`getGhCliInfo`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/gh.ts#L93) and [`checkGhCli`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/gh.ts#L121) in [`src/cli/doctor/checks/gh.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/gh.ts), which executes [`gh --version`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L429) and [`gh auth status`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L784) commands and parses their output.
**Language Server Protocol (LSP) and Micro-Agent Compute Protocol (MCP) server configurations** are also subjected to diagnostic scrutiny. The system checks for the presence of common LSP servers, reporting which ones are installed and which are missing, providing a comprehensive overview of the development environment's code intelligence capabilities. Similarly, it examines MCP server configurations, differentiating between built-in and user-defined servers, and validating their settings. The [`checkLspServers`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/lsp.ts#L46) function in [`src/cli/doctor/checks/lsp.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/lsp.ts) and [`checkBuiltinMcpServers`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/mcp.ts#L67) and [`checkUserMcpServers`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/mcp.ts#L78) functions in [`src/cli/doctor/checks/mcp.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/mcp.ts) contain the logic for these respective checks.
Furthermore, the diagnostic suite includes checks for the **[`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54)CLI installation** , ensuring that the command-line interface itself is installed and meets the minimum required version for compatibility. This prevents issues arising from outdated [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) environments. The version comparison logic and installation checks are handled by [`checkOpenCodeInstallation`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/opencode.ts#L74) in [`src/cli/doctor/checks/opencode.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/opencode.ts).
Finally, **plugin registration** is verified to ensure that the primary [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) plugin is correctly registered within the [`opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/lsp/config.ts#L54) environment, and **application version status** checks determine if the current version is up-to-date, pinned, or in development mode, and whether any updates are available. These checks ensure that the application itself is operating within expected parameters. The [`checkPluginRegistration`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/plugin.ts#L80) function in [`src/cli/doctor/checks/plugin.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/plugin.ts) and [`checkVersionStatus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/version.ts#L69) function in [`src/cli/doctor/checks/version.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/version.ts) respectively address these concerns.
All these diagnostic checks are aggregated by [`getAllCheckDefinitions`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/index.ts#L22) in [`src/cli/doctor/checks/index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/checks/index.ts), making them easily discoverable and executable by the main [`doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/index.ts#L4) utility, which then presents the results in a structured and user-friendly format (see [Output Formatting and Presentation](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#health-diagnostics-and-environment-checks-output-formatting-and-presentation)).
### Output Formatting and Presentation
link

The diagnostic results of the [`doctor`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/index.ts#L4) command-line interface are presented to the user through a dedicated formatter module located at [`src/cli/doctor/formatter.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/formatter.ts). This module ensures clarity and consistency in the console output by utilizing Unicode symbols and colors for different statuses.
Individual check outcomes are formatted to display the check's name, status, and an associated message. Optional detailed explanations can also be included, providing more context to the user. For visual organization, category headers are generated, grouping related checks together. An overall summary provides a concise overview of the diagnostic run, including counts for passed, failed, warned, and skipped checks, as well as the total execution duration.
To assist users in resolving issues, the formatter extracts help suggestions from failed checks. These suggestions often include actionable advice such as "Run:", "Install:", or "Visit:" prompts. In addition to human-readable console output, the system can also produce machine-readable JSON output, which is useful for integration with other tools or automated pipelines. The [`formatBox`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/formatter.ts#L95) utility, also found in [`src/cli/doctor/formatter.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/formatter.ts), allows content to be enclosed within an ASCII box, complete with an optional title, enhancing readability. This formatting approach, tested rigorously in [`src/cli/doctor/formatter.test.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/doctor/formatter.test.ts), ensures that diagnostic information is both easily digestible and programmatically accessible. More details about the diagnostic checks themselves are available in [Health Diagnostics and Environment Checks](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#health-diagnostics-and-environment-checks).
