## Agent Orchestration and Core System
link

The system provides an agent orchestration layer for the OpenCode environment, enabling multi-model AI agents to collaborate on complex development tasks. It uses a specialist-orchestrator pattern, where a primary orchestrator agent, [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161), directs various specialized agents to achieve defined goals. This architecture is described in [`src/agents`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents).
Core configurations are managed through a centralized system that defines schemas for permissions, agent overrides, and feature settings, ensuring runtime validation and static type inference. This configuration system is detailed in [Configuration Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#configuration-management). The [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) plugin integrates with the OpenCode environment by loading, validating, and merging user-level and project-level configurations, influencing plugin behavior and feature enablement as explained in [Plugin Integration and Configuration Flow](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-orchestration-and-core-system-plugin-integration-and-configuration-flow).
A comprehensive hook system extends the system's functionalities by intercepting and modifying agent behavior at various lifecycle points. These hooks manage context, control behavior, handle notifications, and facilitate session recovery, as further elaborated in [Lifecycle Hooks and Behavior Modification](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#lifecycle-hooks-and-behavior-modification). The [`OhMyOpenCodePlugin`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/index.ts#L62) in [`src/index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/index.ts) orchestrates these hooks, alongside tools and features, to manage AI interactions, context windows, and session recovery. The system's shared utilities, located in [`src/shared`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/shared), provide common functionalities for configuration, file management, and error handling, ensuring consistent application behavior.
### Core Agent System Architecture
link

The AI agent system operates on a specialist-orchestrator pattern, designed for multi-model orchestration of complex development tasks. At its core, this architecture employs a central orchestrator agent, [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161), which delegates tasks to various specialized sub-agents. This modular approach allows for the distribution of responsibilities, leveraging agents tailored for specific domains such as technical advising, codebase research, UI generation, documentation, and multimodal analysis.
The system's architectural design is documented within the [`src/agents/AGENTS.md`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/AGENTS.md) file, which outlines the functionality, model configurations, and extension guidelines for seven distinct AI agents. This documentation emphasizes the specialist-orchestrator model, with [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) ([`src/agents/sisyphus.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus.ts)) serving as the primary orchestrator.
Agent creation and customization are managed centrally, providing a structured way to define and configure each agent's behavior. This includes setting their operational context, decision frameworks, and specific instructions through detailed system prompts. For instance, the [`createSisyphusAgent`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus.ts#L475) function instantiates the [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) orchestrator, dynamically adjusting its reasoning budget based on the model used. Similarly, specialized agents like the [`Oracle`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L174) ([`src/agents/oracle.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/oracle.ts)), [`Librarian`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L176) ([`src/agents/librarian.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/librarian.ts)), and [`Frontend UI/UX Engineer`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L175) ([`src/agents/frontend-ui-ux-engineer.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/frontend-ui-ux-engineer.ts)) are configured with precise [`AgentConfig`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/CONTRIBUTING.md?plain=1#L153) objects that define their persona, mission, and operational constraints.
A key aspect of this architecture is the dynamic generation of structured prompts. The [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) orchestrator relies on detailed prompts that include information about available agents, tools, and skills. This process is handled by the [`src/agents/sisyphus-prompt-builder.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts) file, which uses interfaces like [`AvailableAgent`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts#L3), [`AvailableTool`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts#L9), and [`AvailableSkill`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts#L14) to format and organize capabilities, trigger conditions, and anti-patterns within these prompts. This dynamic prompt generation ensures that [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) always has the most up-to-date context regarding its available resources and how to effectively utilize them.
Agent permissions and core prompts are meticulously defined to control their execution modes. For example, [`BUILD_SYSTEM_PROMPT`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/build-prompt.ts#L13) ([`src/agents/build-prompt.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/build-prompt.ts)) grants an agent full execution privileges for implementation and system changes, while [`PLAN_SYSTEM_PROMPT`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L9) ([`src/agents/plan-prompt.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts)) enforces a read-only mode, restricting the agent to analysis and planning to ensure safety during strategic phases. The [`src/agents/utils.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts) file manages the creation and configuration of these built-in agents, including handling overrides and dynamically injecting environmental context, as further detailed in [Agent Configuration and Utility Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-definitions-and-architecture-agent-configuration-and-utility-management).
### Dynamic Agent Prompt Generation
link

The system dynamically generates structured prompts for the [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) orchestrator agent to guide its decision-making and task delegation. This process is crucial for enabling multi-model orchestration, as [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) relies on these prompts to understand the capabilities of various specialized agents and tools, and to effectively coordinate complex development tasks.
The generation of these prompts involves constructing several distinct sections that provide [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) with comprehensive operational guidelines. Key interfaces like [`AvailableAgent`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts#L3), [`AvailableTool`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts#L9), and [`AvailableSkill`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts#L14) define the structure for organizing information about each component. These interfaces include properties such as [`name`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L95), [`description`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/tools/skill/tools.ts#L129), [`category`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/cli/index.ts#L131), and [`metadata`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L117), which are essential for detailing their functionalities and usage contexts.
The prompt builder, primarily located in [`src/agents/sisyphus-prompt-builder.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts), categorizes tools and skills, extracts concise trigger phrases, and formats this information into human-readable markdown. For instance, tools are categorized (e.g., [`lsp`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L994), [`ast`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/bun.lock#L8), [`search`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L183)) to help [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) efficiently select the appropriate one. Skills have their descriptions parsed to identify "trigger" conditions, informing [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) exactly "when to use" a particular skill.
The generated prompt includes dedicated sections for:
  * **Key Triggers** : Highlighting conditions under which specific agents or skills should be activated.
  * **Tool Selection** : A table detailing available skills, tools, and agents, along with their associated "cost" and usage conditions.
  * **Specialized Agent Guidance** : Sections dedicated to agents like "Explore" and "Librarian," clarifying their unique roles and differentiation (e.g., internal vs. external search).
  * **Delegation Instructions** : Guidance on when to delegate tasks to other specialized agents, such as the [`frontend-ui-ux-engineer`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L336) for visual frontend changes.
  * **Hard Blocks and Anti-Patterns** : Explicit instructions on actions to avoid, including coding practices and behaviors deemed undesirable, dynamically incorporating specific anti-patterns if relevant agents are present.

This dynamic prompt generation ensures that [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) always operates with an up-to-date and contextually relevant understanding of its environment, enabling it to orchestrate specialized agents efficiently and avoid common pitfalls. This process is integral to the overall [Core Agent System Architecture](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-orchestration-and-core-system-core-agent-system-architecture).
### Plugin Integration and Configuration Flow
link

The [`oh-my-opencode`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L328) plugin integrates into the OpenCode environment by orchestrating various hooks, tools, and features that enhance the AI's capabilities and user experience. This integration begins with the dynamic loading and merging of configuration files, which dictates the plugin's overall behavior and feature enablement.
The core of this process is handled by the [`OhMyOpenCodePlugin`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/index.ts#L62) function in [`src/index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/index.ts), which serves as the main entry point for the plugin. It initializes and registers all other components based on the loaded configuration.
Configuration loading is managed by [`loadPluginConfig`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-config.ts#L92) in [`src/plugin-config.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-config.ts). This function is responsible for finding and parsing configuration files, first at the user level and then at the project level. It prioritizes [`.jsonc`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L761) files (JSON with comments) over [`.json`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-config.ts#L96) files. The [`mergeConfigs`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/plugin-config.ts#L50) function then combines these configurations, allowing project-specific settings to override user defaults. This merging strategy uses deep merging for nested objects like [`agents`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L809) and ensures unique entries for lists of disabled components (e.g., [`disabled_agents`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L869), [`disabled_hooks`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L721), [`disabled_commands`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/features/builtin-commands/types.ts#L6), [`disabled_skills`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L609)). The configuration is validated against [`OhMyOpenCodeConfigSchema`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/config/schema.ts#L235) to ensure structural integrity and provide type safety, logging any errors encountered during this process.
Once the effective plugin configuration is established, it determines which features and hooks are enabled or disabled. This modular approach allows for fine-grained control over the plugin's behavior, enabling users to customize its functionality. For instance, various hooks for context window management, session recovery, and dynamic prompt generation are conditionally activated based on these settings. Similarly, the availability of built-in tools and the integration of specialized agents are influenced by the configuration. The plugin discovers and merges AI skills from user, project, and global sources, providing them to the AI through specialized tools, with filtering based on configuration and system Micro-Component Provider (MCP) names.
The plugin also manages session lifecycle events, tracking active sessions and coordinating resource cleanup. It integrates with an Antigravity authentication system for Google services, allowing for secure token management and API request transformation. The overall design emphasizes modularity and an event-driven architecture, enabling the plugin to react dynamically to OpenCode events and environmental changes. The system's hooks are crucial for intercepting and modifying agent behavior at various stages, from context management to user notifications and iterative workflow handling, all driven by the initial configuration. For further details on how individual components are defined and managed, refer to [Agent Configuration and Utility Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-definitions-and-architecture-agent-configuration-and-utility-management) and [Feature Orchestration](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#feature-orchestration).
