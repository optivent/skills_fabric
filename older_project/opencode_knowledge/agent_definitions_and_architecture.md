## Agent Definitions and Architecture
link

The AI agent system is structured around a multi-model orchestration paradigm, where specialized agents collaborate on complex development tasks. This system is defined and managed within the [`src/agents`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents) directory. The architectural framework, detailed in [`src/agents/AGENTS.md`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/AGENTS.md), outlines a specialist-orchestrator pattern. At its core, the system relies on dynamic prompt generation and a configurable structure for agent creation, customization, and behavior.
A central concept in this architecture is the role of metadata. Each agent is associated with [`AgentPromptMetadata`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/types.ts#L29) (defined in [`src/agents/types.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/types.ts)), which categorizes agents, indicates their operational cost, and specifies trigger conditions for their invocation. This metadata is crucial for the orchestrator agent to effectively choose and manage the appropriate specialist for a given task. For more details on prompt generation, see [Dynamic Agent Prompt Generation](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-orchestration-and-core-system-dynamic-agent-prompt-generation).
Agent configurations are managed centrally, with functions like [`createBuiltinAgents`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L86) in [`src/agents/utils.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts) handling the generation and customization of agent settings. This includes applying [`agentOverrides`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L88), dynamically injecting environmental context, and integrating prompt metadata to guide agent behavior. The [`builtinAgents`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/index.ts#L10) constant in [`src/agents/index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/index.ts) provides a consolidated registry for all predefined agent configurations, making them accessible throughout the application.
### Orchestrator Agent: Sisyphus
link

The [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) orchestrator agent coordinates various specialized agents to accomplish complex development tasks through a multi-phase operational guideline, dynamic prompt generation, and a structured task management approach. The configuration for [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) is defined in [`src/agents/sisyphus.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus.ts).
The agent's behavior is guided by a detailed prompt that outlines a multi-phase workflow. This includes an initial "Intent Gate" for request classification and validation, followed by a "Codebase Assessment" phase to analyze project maturity. Subsequent phases involve parallel "Exploration & Research" using agents like [`explore`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L19) and [`librarian`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L18), "Implementation" with clear delegation structures and GitHub workflow integration, and a "Failure Recovery" protocol. The final "Completion" phase defines criteria for task verification and delivery. This structure is designed to ensure disciplined execution and effective delegation of tasks.
The agent's prompt is dynamically constructed using available agents, tools, and skills, as detailed in [Dynamic Agent Prompt Generation](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-orchestration-and-core-system-dynamic-agent-prompt-generation). The [`buildDynamicSisyphusPrompt`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus.ts#L393) function in [`src/agents/sisyphus.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus.ts) is responsible for assembling this prompt. It integrates various instructional sections, dynamically generated tables for tool and agent selection, and outlines constraints and anti-patterns to guide the agent's actions. The [`createSisyphusAgent`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus.ts#L475) function instantiates the [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) agent, setting its description, operational mode, and token limits, and dynamically adjusts its reasoning budget based on the underlying language model (e.g., GPT models receive a different budget). This dynamic configuration allows [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161) to adapt to diverse operational environments and available capabilities.
### Specialist Agent Definitions
link
Agent Name | Role/Function | File Path  
---|---|---  
Oracle | Strategic technical advisor for complex analysis and architectural decisions | `/code-yeongyu/oh-my-opencode/src/agents/oracle.ts`  
Librarian | Specialized open-source codebase understanding agent; answers questions about open-source libraries by finding evidence with GitHub permalinks | `/code-yeongyu/oh-my-opencode/src/agents/librarian.ts`  
Explore | Codebase search specialist; finds files and code, returns actionable results for questions like "Where is X implemented?" | `/code-yeongyu/oh-my-opencode/src/agents/explore.ts`  
Frontend UI/UX Engineer | Crafts visually stunning UI/UX, focusing on pixel-perfect details, smooth animations, and intuitive interactions | `/code-yeongyu/oh-my-opencode/src/agents/frontend-ui-ux-engineer.ts`  
Document Writer | Technical writer who transforms complex codebases into clear, comprehensive documentation (READMEs, API docs, user guides) | `/code-yeongyu/oh-my-opencode/src/agents/document-writer.ts`  
Multimodal Looker | Interprets media files (PDFs, images, diagrams) to extract specific information or describe visual content | `/code-yeongyu/oh-my-opencode/src/agents/multimodal-looker.ts`  
The system employs several specialized AI agents, each designed for distinct development tasks. These agents operate as subagents within a larger orchestration framework, leveraging detailed prompts to define their behavior, operational context, and output formats. This multi-model orchestration approach allows the system to delegate complex tasks to agents with tailored expertise.
The [`Oracle`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L174) agent, defined in [`src/agents/oracle.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/oracle.ts), functions as a strategic technical advisor. It provides guidance on architectural decisions, code analysis, and engineering problems, emphasizing detailed reasoning and structured responses. Its behavior is primarily shaped by an extensive system prompt that outlines its role, decision framework, and response format. The Oracle agent is designed to be invoked for complex, high-level advising tasks, reflecting its "EXPENSIVE" cost. Its configuration adapts to the underlying AI model, optimizing reasoning effort and verbosity based on model capabilities.
The [`Librarian`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L176) agent, configured in [`src/agents/librarian.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/librarian.ts), specializes in understanding open-source codebases. This agent is designed to answer questions about libraries by searching and synthesizing information, with a strong focus on providing evidence through GitHub permalinks. Its detailed prompt dictates a structured approach to problem-solving, including request classification, tool execution based on request type (e.g., conceptual questions, implementation references), evidence synthesis, and mandatory citation formats. The Librarian agent operates in a read-only capacity, focusing on information retrieval and analysis without modifying code.
For codebase exploration, the [`Explore`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L177) agent, defined in [`src/agents/explore.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/explore.ts), acts as a search specialist. It is designed to locate specific code, understand file contents, and identify functional implementations. The agent's prompt mandates intent analysis, parallel tool execution for efficiency, and structured output. It is constrained to read-only operations, ensuring safe exploration of the codebase.
The [`Frontend UI/UX Engineer`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L175) agent, found in [`src/agents/frontend-ui-ux-engineer.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/frontend-ui-ux-engineer.ts), is specialized in generating visually compelling and user-friendly web interfaces. This agent's extensive prompt defines its persona as a "designer-turned-developer" and includes mission statements, work principles, a detailed design process, aesthetic guidelines for typography, color, motion, and spatial composition, and a list of anti-patterns to avoid. It focuses on creating visually striking interfaces, even in the absence of explicit design mockups.
The [`Document Writer`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/document-writer.ts#L9) agent, configured in [`src/agents/document-writer.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/document-writer.ts), specializes in technical documentation. It is designed to create clear, comprehensive documentation, such as README files, API documentation, architecture documents, and user guides. The agent's prompt includes a core mission, a code of conduct emphasizing diligence and accuracy, a strict workflow for documentation generation and verification, and a quality checklist. It promotes aggressive exploration and parallel tool execution to ensure thorough and accurate documentation.
Finally, the [`Multimodal Looker`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/multimodal-looker.ts#L9) agent, defined in [`src/agents/multimodal-looker.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/multimodal-looker.ts), is a utility agent designed to analyze and extract information from non-textual media files, such as PDFs, images, and diagrams. Its purpose is to interpret attached files based on a specific goal, extracting only the requested information without processing raw file contents, thereby optimizing token usage. This agent operates in an interpretation-only capacity, with all standard modification tools disabled.
Each of these specialist agents contributes to a multi-model orchestration strategy, allowing the system to handle a diverse range of development tasks by delegating to the most appropriate expert agent. The management of these agents, including their configurations and utilities, is centralized to ensure consistent behavior across the system. See [Agent Configuration and Utility Management](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-definitions-and-architecture-agent-configuration-and-utility-management) for further details. Their specific permissions and foundational prompts also dictate their operational modes and constraints. More information can be found in [Agent Permission and Prompt Definitions](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-definitions-and-architecture-agent-permission-and-prompt-definitions).
### Agent Configuration and Utility Management
link

The system centralizes the management of AI agent configurations, providing a structured approach for defining, creating, and customizing agents. This ensures consistency and simplifies the process of integrating new agent functionalities or modifying existing ones.
The core of agent configuration lies in the types and interfaces defined in [`src/agents/types.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/types.ts). These definitions include [`AgentFactory`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/types.ts#L3) for generating agent configurations, [`AgentCategory`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/types.ts#L8) and [`AgentCost`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/types.ts#L13) for classification, and [`DelegationTrigger`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/types.ts#L18) for specifying conditions under which tasks are delegated. Critically, [`AgentPromptMetadata`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/types.ts#L29) allows for rich, structured metadata about each agent, including their operational triggers ([`useWhen`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts#L152), [`avoidWhen`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/sisyphus-prompt-builder.ts#L153)) and dedicated prompt sections. This metadata is instrumental in dynamically generating comprehensive prompts for orchestrator agents like Sisyphus.
Built-in agents, such as [`Sisyphus`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L161), [`oracle`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L17), and [`librarian`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L18), are defined and managed through the utilities in [`src/agents/utils.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts). This module provides a centralized mechanism for their creation, allowing for the application of [`agentOverrides`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L88) to customize agent behavior without altering core definitions. For instance, the [`mergeAgentConfig`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L72) function facilitates appending custom text to an agent's prompt, while [`createEnvContext`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L52) dynamically injects environmental details like current time and timezone into agent prompts, enhancing their contextual awareness. The [`createBuiltinAgents`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L86) function orchestrates the entire process, filtering disabled agents, applying overrides, and injecting context before making the configured agents available.
All these agent definitions and utility functions are aggregated and re-exported through [`src/agents/index.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/index.ts), creating a single point of access for developers. This module makes it straightforward to retrieve configurations for all built-in agents and provides a clear [`Record<string, AgentConfig>`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/utils.ts#L77) for easy lookup and use throughout the application.
### Agent Permission and Prompt Definitions
link
Feature | `BUILD_SYSTEM_PROMPT` |  `PLAN_SYSTEM_PROMPT` Sustainably sourced from various files located within the project, ensuring consistency and ease of maintenance. | Purpose | Sustainably sourced from various files located within the project, ensuring consistency and ease of maintenance. | Sustainably sourced from various files located within the project, ensuring consistency and ease of maintenance.  
---|---|---|---|---|---  
Purpose | Implements, builds, and executes features and changes. | Observes, analyzes, and plans to accomplish goals in a read-only phase.  
Mode | FULL EXECUTION | READ-ONLY (CRITICAL)  
Execution Phase | ACTIVE | READ-ONLY  
Mode Description | Focused on building, implementing, and executing. | Critically, this agent is **READ-ONLY** , preventing any file modifications or system changes. It focuses on observation, analysis, and planning.  
Edit Permission |  `ask` (Can modify files with confirmation) |  `deny` (No file modifications) | `edit` | `ask`  
Bash Permissions |  `ask` (Can execute commands with confirmation) | Specific Commands (e.g., `ls`, `grep`, `git log`) are `allow`, other commands are `ask`. No file manipulation commands allowed. | `deny`  
Webfetch | `allow` | `allow` | ---  
Status | Active development, continuously tested and improved. | In Planning, the user wants you to research and analyze to construct a well-formed plan, avoiding modifications.  
Key Responsibilities | Implement features, execute commands, fix bugs, refactor code, deploy systems, make file modifications. | Think, read, search, plan, and delegate to explore agents to construct comprehensive yet concise plans.  
Max. Permitted File Edits |  | Deny (`deny`)  
User Interface | Provides tools to manipulate files and system states. | Provides tools for observation, analysis, and plan construction, without modifying files or system states.  
Phase Goal | To implement, build, and deliver working, tested, and production-ready solutions. | To deliver a well-researched, comprehensive, yet concise plan that accomplishes the user's goal.  
User Interaction | Ask for clarification when requirements are ambiguous, then execute confidently. | Ask for clarifying questions or opinions when weighing tradeoffs; do not make large assumptions.  
Agent permissions and foundational prompts define the operational boundaries and instructions for various AI agents, dictating their execution modes and constraints. For instance, the system differentiates between agents designed for full execution, like those using [`BUILD_SYSTEM_PROMPT`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/build-prompt.ts#L13), and agents restricted to read-only analysis, such as those employing [`PLAN_SYSTEM_PROMPT`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L9).
The [`BUILD_SYSTEM_PROMPT`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/build-prompt.ts#L13) in [`src/agents/build-prompt.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/build-prompt.ts) is configured for agents operating in an "EXECUTION phase." This prompt grants agents extensive permissions for actions such as implementing features, modifying code, executing commands, and making system changes. While providing broad capabilities, it integrates safety measures by requiring user confirmation for critical actions like file edits and shell command execution, as specified by its [`BUILD_PERMISSION`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/build-prompt.ts#L64) which sets [`edit`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/oracle.ts#L106) and [`bash`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L49) to [`"ask"`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L237).
Conversely, the [`PLAN_SYSTEM_PROMPT`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L9) in [`src/agents/plan-prompt.ts`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts) establishes a strictly read-only environment for planning agents. This prompt explicitly forbids file edits or system modifications, directing the agent to focus solely on analysis, research, and plan formulation. The associated [`PLAN_PERMISSION`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L47) sets [`edit`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/oracle.ts#L106) to [`"deny"`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/README.md?plain=1#L863), reinforcing this constraint. For shell commands, it allows safe informational commands (e.g., [`ls*`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L70), [`grep*`](https://github.com/code-yeongyu/oh-my-opencode/blob/d0694e5aa4ecd5e0179718e190136f8b213200d9/src/agents/plan-prompt.ts#L67)) but requires user confirmation for any command that could potentially modify files. Both types of agents are typically allowed to fetch web content, enabling them to gather necessary external information without restrictions. These definitions are crucial for orchestrating multi-model behavior by clearly segmenting agent responsibilities and capabilities within the system. For more information on how these prompts are dynamically generated, refer to [Dynamic Agent Prompt Generation](https://codewiki.google/github.com/code-yeongyu/oh-my-opencode#agent-orchestration-and-core-system-dynamic-agent-prompt-generation).
