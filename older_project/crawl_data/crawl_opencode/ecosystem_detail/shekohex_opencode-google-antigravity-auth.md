# SOURCE: https://github.com/shekohex/opencode-google-antigravity-auth

[Skip to content](https://github.com/shekohex/opencode-google-antigravity-auth#start-of-content)
## Navigation Menu
Toggle navigation
[ ](https://github.com/)
[ Sign in ](https://github.com/login?return_to=https%3A%2F%2Fgithub.com%2Fshekohex%2Fopencode-google-antigravity-auth)
Appearance settings
  * Platform
    * AI CODE CREATION
      * [ GitHub CopilotWrite better code with AI ](https://github.com/features/copilot)
      * [ GitHub SparkBuild and deploy intelligent apps ](https://github.com/features/spark)
      * [ GitHub ModelsManage and compare prompts ](https://github.com/features/models)
      * [ MCP RegistryNewIntegrate external tools ](https://github.com/mcp)
    * DEVELOPER WORKFLOWS
      * [ ActionsAutomate any workflow ](https://github.com/features/actions)
      * [ CodespacesInstant dev environments ](https://github.com/features/codespaces)
      * [ IssuesPlan and track work ](https://github.com/features/issues)
      * [ Code ReviewManage code changes ](https://github.com/features/code-review)
    * APPLICATION SECURITY
      * [ GitHub Advanced SecurityFind and fix vulnerabilities ](https://github.com/security/advanced-security)
      * [ Code securitySecure your code as you build ](https://github.com/security/advanced-security/code-security)
      * [ Secret protectionStop leaks before they start ](https://github.com/security/advanced-security/secret-protection)
    * EXPLORE
      * [Why GitHub](https://github.com/why-github)
      * [Documentation](https://docs.github.com)
      * [Blog](https://github.blog)
      * [Changelog](https://github.blog/changelog)
      * [Marketplace](https://github.com/marketplace)
[View all features](https://github.com/features)
  * Solutions
    * BY COMPANY SIZE
      * [Enterprises](https://github.com/enterprise)
      * [Small and medium teams](https://github.com/team)
      * [Startups](https://github.com/enterprise/startups)
      * [Nonprofits](https://github.com/solutions/industry/nonprofits)
    * BY USE CASE
      * [App Modernization](https://github.com/solutions/use-case/app-modernization)
      * [DevSecOps](https://github.com/solutions/use-case/devsecops)
      * [DevOps](https://github.com/solutions/use-case/devops)
      * [CI/CD](https://github.com/solutions/use-case/ci-cd)
      * [View all use cases](https://github.com/solutions/use-case)
    * BY INDUSTRY
      * [Healthcare](https://github.com/solutions/industry/healthcare)
      * [Financial services](https://github.com/solutions/industry/financial-services)
      * [Manufacturing](https://github.com/solutions/industry/manufacturing)
      * [Government](https://github.com/solutions/industry/government)
      * [View all industries](https://github.com/solutions/industry)
[View all solutions](https://github.com/solutions)
  * Resources
    * EXPLORE BY TOPIC
      * [AI](https://github.com/resources/articles?topic=ai)
      * [Software Development](https://github.com/resources/articles?topic=software-development)
      * [DevOps](https://github.com/resources/articles?topic=devops)
      * [Security](https://github.com/resources/articles?topic=security)
      * [View all topics](https://github.com/resources/articles)
    * EXPLORE BY TYPE
      * [Customer stories](https://github.com/customer-stories)
      * [Events & webinars](https://github.com/resources/events)
      * [Ebooks & reports](https://github.com/resources/whitepapers)
      * [Business insights](https://github.com/solutions/executive-insights)
      * [GitHub Skills](https://skills.github.com)
    * SUPPORT & SERVICES
      * [Documentation](https://docs.github.com)
      * [Customer support](https://support.github.com)
      * [Community forum](https://github.com/orgs/community/discussions)
      * [Trust center](https://github.com/trust-center)
      * [Partners](https://github.com/partners)
  * Open Source
    * COMMUNITY
      * [ GitHub SponsorsFund open source developers ](https://github.com/sponsors)
    * PROGRAMS
      * [Security Lab](https://securitylab.github.com)
      * [Maintainer Community](https://maintainers.github.com)
      * [Accelerator](https://github.com/accelerator)
      * [Archive Program](https://archiveprogram.github.com)
    * REPOSITORIES
      * [Topics](https://github.com/topics)
      * [Trending](https://github.com/trending)
      * [Collections](https://github.com/collections)
  * Enterprise
    * ENTERPRISE SOLUTIONS
      * [ Enterprise platformAI-powered developer platform ](https://github.com/enterprise)
    * AVAILABLE ADD-ONS
      * [ GitHub Advanced SecurityEnterprise-grade security features ](https://github.com/security/advanced-security)
      * [ Copilot for BusinessEnterprise-grade AI features ](https://github.com/features/copilot/copilot-business)
      * [ Premium SupportEnterprise-grade 24/7 support ](https://github.com/premium-support)
  * [Pricing](https://github.com/pricing)


Search or jump to...
# Search code, repositories, users, issues, pull requests...
Search 
Clear
[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)
#  Provide feedback 
We read every piece of feedback, and take your input very seriously.
Include my email address so I can be contacted
Cancel  Submit feedback 
#  Saved searches 
## Use saved searches to filter your results more quickly
Name
Query
To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax). 
Cancel  Create saved search 
[ Sign in ](https://github.com/login?return_to=https%3A%2F%2Fgithub.com%2Fshekohex%2Fopencode-google-antigravity-auth)
[ Sign up ](https://github.com/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=shekohex%2Fopencode-google-antigravity-auth)
Appearance settings
Resetting focus
You signed in with another tab or window. [Reload](https://github.com/shekohex/opencode-google-antigravity-auth) to refresh your session. You signed out in another tab or window. [Reload](https://github.com/shekohex/opencode-google-antigravity-auth) to refresh your session. You switched accounts on another tab or window. [Reload](https://github.com/shekohex/opencode-google-antigravity-auth) to refresh your session. Dismiss alert
{{ message }}
[ shekohex ](https://github.com/shekohex) / **[opencode-google-antigravity-auth](https://github.com/shekohex/opencode-google-antigravity-auth) ** Public
forked from [jenslys/opencode-gemini-auth](https://github.com/jenslys/opencode-gemini-auth)
  * [ ](https://github.com/login?return_to=%2Fshekohex%2Fopencode-google-antigravity-auth) You must be signed in to change notification settings
  * [ 3 ](https://github.com/login?return_to=%2Fshekohex%2Fopencode-google-antigravity-auth)
  * [ Star  91 ](https://github.com/login?return_to=%2Fshekohex%2Fopencode-google-antigravity-auth)


Antigravity (Google) auth plugin for opencode 
[www.npmjs.com/package/opencode-google-antigravity-auth](https://www.npmjs.com/package/opencode-google-antigravity-auth "https://www.npmjs.com/package/opencode-google-antigravity-auth")
### License
[ ](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/LICENSE)
[ 91 stars ](https://github.com/shekohex/opencode-google-antigravity-auth/stargazers) [ 26 forks ](https://github.com/shekohex/opencode-google-antigravity-auth/forks) [ Branches ](https://github.com/shekohex/opencode-google-antigravity-auth/branches) [ Tags ](https://github.com/shekohex/opencode-google-antigravity-auth/tags) [ Activity ](https://github.com/shekohex/opencode-google-antigravity-auth/activity)
[ Star  ](https://github.com/login?return_to=%2Fshekohex%2Fopencode-google-antigravity-auth)
[ ](https://github.com/login?return_to=%2Fshekohex%2Fopencode-google-antigravity-auth) You must be signed in to change notification settings
  * [ Code ](https://github.com/shekohex/opencode-google-antigravity-auth)
  * [ Issues 3 ](https://github.com/shekohex/opencode-google-antigravity-auth/issues)
  * [ Pull requests 1 ](https://github.com/shekohex/opencode-google-antigravity-auth/pulls)
  * [ Discussions ](https://github.com/shekohex/opencode-google-antigravity-auth/discussions)
  * [ Actions ](https://github.com/shekohex/opencode-google-antigravity-auth/actions)
  * [ Security ](https://github.com/shekohex/opencode-google-antigravity-auth/security)
[ ](https://github.com/shekohex/opencode-google-antigravity-auth/security)
[ ](https://github.com/shekohex/opencode-google-antigravity-auth/security)
[ ](https://github.com/shekohex/opencode-google-antigravity-auth/security)
### [ Uh oh!  ](https://github.com/shekohex/opencode-google-antigravity-auth/security)
[There was an error while loading. ](https://github.com/shekohex/opencode-google-antigravity-auth/security)[Please reload this page](https://github.com/shekohex/opencode-google-antigravity-auth).
  * [ Insights ](https://github.com/shekohex/opencode-google-antigravity-auth/pulse)


Additional navigation options
  * [ Code  ](https://github.com/shekohex/opencode-google-antigravity-auth)
  * [ Issues  ](https://github.com/shekohex/opencode-google-antigravity-auth/issues)
  * [ Pull requests  ](https://github.com/shekohex/opencode-google-antigravity-auth/pulls)
  * [ Discussions  ](https://github.com/shekohex/opencode-google-antigravity-auth/discussions)
  * [ Actions  ](https://github.com/shekohex/opencode-google-antigravity-auth/actions)
  * [ Security  ](https://github.com/shekohex/opencode-google-antigravity-auth/security)
  * [ Insights  ](https://github.com/shekohex/opencode-google-antigravity-auth/pulse)


# shekohex/opencode-google-antigravity-auth
main
[Branches](https://github.com/shekohex/opencode-google-antigravity-auth/branches)[Tags](https://github.com/shekohex/opencode-google-antigravity-auth/tags)
[](https://github.com/shekohex/opencode-google-antigravity-auth/branches)[](https://github.com/shekohex/opencode-google-antigravity-auth/tags)
Go to file
Code
Open more actions menu
## Folders and files
Name | Name | Last commit message | Last commit date  
---|---|---|---  
## Latest commit
## History
[137 Commits](https://github.com/shekohex/opencode-google-antigravity-auth/commits/main/)[](https://github.com/shekohex/opencode-google-antigravity-auth/commits/main/)  
[.github](https://github.com/shekohex/opencode-google-antigravity-auth/tree/main/.github ".github") | [.github](https://github.com/shekohex/opencode-google-antigravity-auth/tree/main/.github ".github") |  |   
[src](https://github.com/shekohex/opencode-google-antigravity-auth/tree/main/src "src") | [src](https://github.com/shekohex/opencode-google-antigravity-auth/tree/main/src "src") |  |   
[tests/integration](https://github.com/shekohex/opencode-google-antigravity-auth/tree/main/tests/integration "This path skips through empty directories") | [tests/integration](https://github.com/shekohex/opencode-google-antigravity-auth/tree/main/tests/integration "This path skips through empty directories") |  |   
[.gitattributes](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/.gitattributes ".gitattributes") | [.gitattributes](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/.gitattributes ".gitattributes") |  |   
[.gitignore](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/.gitignore ".gitignore") | [.gitignore](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/.gitignore ".gitignore") |  |   
[LICENSE](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/LICENSE "LICENSE") | [LICENSE](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/LICENSE "LICENSE") |  |   
[README.md](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/README.md "README.md") | [README.md](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/README.md "README.md") |  |   
[bun.lock](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/bun.lock "bun.lock") | [bun.lock](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/bun.lock "bun.lock") |  |   
[index.ts](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/index.ts "index.ts") | [index.ts](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/index.ts "index.ts") |  |   
[package.json](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/package.json "package.json") | [package.json](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/package.json "package.json") |  |   
[release.sh](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/release.sh "release.sh") | [release.sh](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/release.sh "release.sh") |  |   
[tsconfig.json](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/tsconfig.json "tsconfig.json") | [tsconfig.json](https://github.com/shekohex/opencode-google-antigravity-auth/blob/main/tsconfig.json "tsconfig.json") |  |   
View all files  
## Repository files navigation
  * [README](https://github.com/shekohex/opencode-google-antigravity-auth)
  * [License](https://github.com/shekohex/opencode-google-antigravity-auth)


# Antigravity OAuth Plugin for Opencode
[](https://github.com/shekohex/opencode-google-antigravity-auth#antigravity-oauth-plugin-for-opencode)
Authenticate the Opencode CLI with your Antigravity (Cloud Code) account so you can use the Antigravity-backed Gemini models with your existing quota.
## Features
[](https://github.com/shekohex/opencode-google-antigravity-auth#features)
  * **Multi-Account Load Balancing** - Automatically rotates between multiple Google accounts when hitting rate limits
  * **Endpoint Fallback** - Tries 3 endpoints (daily → autopush → prod) for maximum reliability
  * **Google Search Tool** - Built-in web search with URL analysis and source citations
  * **Cross-Model Conversations** - Seamlessly switch between Gemini and Claude with thinking block preservation
  * **Automatic Token Refresh** - Handles auth transparently with no manual intervention


## Setup
[](https://github.com/shekohex/opencode-google-antigravity-auth#setup)
  1. Add the plugin to your [Opencode config](https://opencode.ai/docs/config/):
```
{
  "$schema": "https://opencode.ai/config.json",
  "plugin": ["opencode-google-antigravity-auth"]
}
```

  2. Run `opencode auth login`.
  3. Choose the Google provider and select **OAuth with Google (Antigravity)**.
  4. Authenticate with your first Google account in the browser.
  5. **Optional:** Add more accounts for load balancing when prompted.


The plugin spins up a local callback listener on `http://localhost:36742/oauth-callback`, so after approving in the browser you'll land on an "Authentication complete" page with no URL copy/paste required. If that port is already taken or you're headless, the CLI automatically falls back to the copy/paste flow and explains what to do.
## Multi-Account Load Balancing
[](https://github.com/shekohex/opencode-google-antigravity-auth#multi-account-load-balancing)
The plugin supports **automatic rotation across multiple Google accounts** to work around rate limits.
### How It Works
[](https://github.com/shekohex/opencode-google-antigravity-auth#how-it-works)
  * **Sticky Account Selection** : Uses the same account for all requests until it hits an error
  * **Automatic Rotation** : When rate-limited (429) or server errors (5xx), switches to next account
  * **Smart Recovery** : Automatically re-enables accounts after rate limit timeout expires
  * **Email Tracking** : Shows which account is in use for easy debugging


### Setup Multiple Accounts
[](https://github.com/shekohex/opencode-google-antigravity-auth#setup-multiple-accounts)
During `opencode auth login`, you'll be prompted to add additional accounts:
```
✓ Account 1 authenticated (user@gmail.com)
You have 1 account(s) configured. Add another? (y/n): y

```

You can add up to 10 accounts. The plugin stores account metadata in `$XDG_DATA_HOME/opencode/antigravity-accounts.json` (for example `~/.local/share/opencode/antigravity-accounts.json`).
### When To Use Multi-Account
[](https://github.com/shekohex/opencode-google-antigravity-auth#when-to-use-multi-account)
  * **High Volume Usage** : If you frequently hit Antigravity rate limits
  * **Production Workflows** : Need maximum uptime for automated tasks
  * **Team Environments** : Share quota across multiple Google accounts


### Monitoring
[](https://github.com/shekohex/opencode-google-antigravity-auth#monitoring)
The plugin logs account switches:
```
[INFO] Using account 1/3 (user@gmail.com)
[INFO] Account 1/3 rate-limited, switching...
[INFO] Using account 2/3 (user2@gmail.com)

```

Toast notifications also appear when switching accounts.
## Google Search Tool
[](https://github.com/shekohex/opencode-google-antigravity-auth#google-search-tool)
The plugin exposes a `google_search` tool that allows models to fetch real-time information from the web using Google Search and URL context analysis.
### How It Works
[](https://github.com/shekohex/opencode-google-antigravity-auth#how-it-works-1)
Due to Gemini API limitations, native search tools (`googleSearch`, `urlContext`) cannot be combined with function declarations (custom tools like `bash`, `read`, `write`) in the same request. The plugin solves this by implementing `google_search` as a **wrapper tool** that makes separate API calls to Gemini with only native search tools enabled.
```
Agent (with custom tools: bash, read, write, etc.)
    │
    └── Calls google_search tool
            │
            └── Makes SEPARATE API call to Gemini with:
                - Model: gemini-2.5-flash
                - Tools: [{ googleSearch: {} }, { urlContext: {} }]
                - Returns formatted markdown with sources

```

### Features
[](https://github.com/shekohex/opencode-google-antigravity-auth#features-1)
  * **Web Search** : Query Google Search for real-time information
  * **URL Analysis** : Fetch and analyze specific URLs when provided
  * **Source Citations** : Returns grounded responses with source links
  * **Thinking Mode** : Optional deep analysis with configurable thinking budget


### Usage
[](https://github.com/shekohex/opencode-google-antigravity-auth#usage)
The tool is automatically available to models that support tool use. Simply ask questions that require current information:
```
"What are the latest news about AI?"
"Summarize this article: https://example.com/article"
"What's the current stock price of AAPL?"

```

When you provide URLs in your query, the model will automatically extract and analyze them.
### Supported Models
[](https://github.com/shekohex/opencode-google-antigravity-auth#supported-models)
All models can use the `google_search` tool since it makes independent API calls:
  * **Gemini models** (2.5 Flash, 3 Pro, 3 Flash, etc.)
  * **Claude models** (via Antigravity proxy)


## Updating
[](https://github.com/shekohex/opencode-google-antigravity-auth#updating)
Opencode does NOT auto-update plugins.
To get the latest version, clear the cached plugin and let Opencode reinstall it:
```
rm -rf ~/.cache/opencode/node_modules/opencode-google-antigravity-auth
opencode
```

Alternatively, remove the dependency from `~/.cache/opencode/package.json` if the above doesn't work.
## Thinking Configuration
[](https://github.com/shekohex/opencode-google-antigravity-auth#thinking-configuration)
Antigravity forwards Gemini model options, including `thinkingConfig`:
  * `thinkingLevel` for Gemini 3 models (`"low" | "medium" | "high"`).
  * `thinkingBudget` for Gemini 2.5 models (number).


### Examples
[](https://github.com/shekohex/opencode-google-antigravity-auth#examples)
```
{
  "provider": {
    "antigravity": {
      "models": {
        "gemini-3-pro-preview": {
          "options": {
            "thinkingConfig": {
              "thinkingLevel": "high",
              "includeThoughts": true
            }
          }
        },
        "gemini-3-flash": {
          "options": {
            "thinkingConfig": {
              "thinkingLevel": "medium",
              "includeThoughts": true
            }
          }
        },
        "gemini-2.5-flash": {
          "options": {
            "thinkingConfig": {
              "thinkingBudget": 8192,
              "includeThoughts": true
            }
          }
        },
        "gemini-claude-opus-4-5-thinking": {
          "options": {
            "thinkingConfig": {
              "thinkingBudget": 32000,
              "includeThoughts": true
            }
          }
        }
      }
    }
  }
}
```

## Claude Proxy Models
[](https://github.com/shekohex/opencode-google-antigravity-auth#claude-proxy-models)
Antigravity provides access to Claude models via `gemini-claude-*` model names. The plugin automatically transforms tool schemas for Claude compatibility.
### Available Claude Models
[](https://github.com/shekohex/opencode-google-antigravity-auth#available-claude-models)
  * `gemini-claude-sonnet-4-5` - Claude Sonnet 4.5
  * `gemini-claude-sonnet-4-5-thinking` - Claude Sonnet 4.5 with thinking
  * `gemini-claude-opus-4-5-thinking` - Claude Opus 4.5 with thinking


### Interleaved Thinking Support
[](https://github.com/shekohex/opencode-google-antigravity-auth#interleaved-thinking-support)
When you use any Claude thinking model (models with `-thinking` suffix), the plugin automatically enables **interleaved thinking** by adding the `anthropic-beta: interleaved-thinking-2025-05-14` header to your requests.
**What is Interleaved Thinking?**
Without interleaved thinking, Claude thinks once at the beginning and then executes all tool calls. With interleaved thinking enabled, Claude can think _between_ tool calls, allowing it to:
  * **Reason about tool results** before deciding what to do next
  * **Chain multiple tool calls** with reasoning steps in between
  * **Make more nuanced decisions** based on intermediate results
  * **Adapt its approach** as it learns more from each tool interaction


**Why This Matters for Coding Agents**
AI coding tools like Opencode heavily rely on tool use (reading files, searching code, running commands). Interleaved thinking significantly improves the quality of multi-step coding tasks because Claude can:
  1. Read a file → _think about what it found_ → decide which file to read next
  2. Run a test → _analyze the failure_ → make a targeted fix
  3. Search for a pattern → _reason about the results_ → refine the search


**Automatic Enablement**
You don't need to configure anything - when you use any `-thinking` Claude model variant, the plugin automatically:
  * Detects the thinking model from the model name suffix
  * Injects the `anthropic-beta: interleaved-thinking-2025-05-14` header
  * Merges with any existing beta headers (e.g., for prompt caching)


This is enabled by default because if you're opting into extended thinking, you almost certainly want the improved reasoning that interleaved thinking provides for tool-heavy workflows.
## Local Development
[](https://github.com/shekohex/opencode-google-antigravity-auth#local-development)
```
git clone https://github.com/shekohex/opencode-google-antigravity-auth.git
cd opencode-google-antigravity-auth
bun install
```

To load a local checkout in Opencode:
```
{
  "$schema": "https://opencode.ai/config.json",
  "plugin": ["file:///absolute/path/to/opencode-google-antigravity-auth"]
}
```

## Example Opencode config with provider/models
[](https://github.com/shekohex/opencode-google-antigravity-auth#example-opencode-config-with-providermodels)
You should copy that config to your opencode config file.
```
{
  "$schema": "https://opencode.ai/config.json",
  "plugin": ["opencode-google-antigravity-auth"],
  "provider": {
    "google": {
      "npm": "@ai-sdk/google",
      "models": {
        "gemini-3-pro-preview": {
          "id": "gemini-3-pro-preview",
          "name": "Gemini 3 Pro Preview",
          "release_date": "2025-11-18",
          "reasoning": true,
          "limit": { "context": 1000000, "output": 64000 },
          "cost": { "input": 2, "output": 12, "cache_read": 0.2 },
          "modalities": { "input": ["text", "image", "video", "audio", "pdf"], "output": ["text"] }
        },
        "gemini-3-pro-high": {
          "id": "gemini-3-pro-preview",
          "name": "Gemini 3 Pro Preview (High Thinking)",
          "options": { "thinkingConfig": { "thinkingLevel": "high", "includeThoughts": true } }
        },
        "gemini-3-pro-medium": {
          "id": "gemini-3-pro-preview",
          "name": "Gemini 3 Pro Preview (Medium Thinking)",
          "options": { "thinkingConfig": { "thinkingLevel": "medium", "includeThoughts": true } }
        },
        "gemini-3-pro-low": {
          "id": "gemini-3-pro-preview",
          "name": "Gemini 3 Pro Preview (Low Thinking)",
          "options": { "thinkingConfig": { "thinkingLevel": "low", "includeThoughts": true } }
        },
        "gemini-3-flash": {
          "id": "gemini-3-flash",
          "name": "Gemini 3 Flash",
          "release_date": "2025-12-17",
          "reasoning": true,
          "limit": { "context": 1048576, "output": 65536 },
          "cost": { "input": 0.5, "output": 3, "cache_read": 0.05 },
          "modalities": { "input": ["text", "image", "video", "audio", "pdf"], "output": ["text"] }
        },
        "gemini-3-flash-high": {
          "id": "gemini-3-flash",
          "name": "Gemini 3 Flash (High Thinking)",
          "options": { "thinkingConfig": { "thinkingLevel": "high", "includeThoughts": true } }
        },
        "gemini-3-flash-medium": {
          "id": "gemini-3-flash",
          "name": "Gemini 3 Flash (Medium Thinking)",
          "options": { "thinkingConfig": { "thinkingLevel": "medium", "includeThoughts": true } }
        },
        "gemini-3-flash-low": {
          "id": "gemini-3-flash",
          "name": "Gemini 3 Flash (Low Thinking)",
          "options": { "thinkingConfig": { "thinkingLevel": "low", "includeThoughts": true } }
        },
        "gemini-2.5-flash": {
          "id": "gemini-2.5-flash",
          "name": "Gemini 2.5 Flash",
          "release_date": "2025-03-20",
          "reasoning": true,
          "limit": { "context": 1048576, "output": 65536 },
          "cost": { "input": 0.3, "output": 2.5, "cache_read": 0.075 },
          "modalities": { "input": ["text", "image", "audio", "video", "pdf"], "output": ["text"] }
        },
        "gemini-2.5-flash-lite": {
          "id": "gemini-2.5-flash-lite",
          "name": "Gemini 2.5 Flash Lite",
          "release_date": "2025-06-17",
          "reasoning": true,
          "limit": { "context": 1048576, "output": 65536 },
          "cost": { "input": 0.1, "output": 0.4, "cache_read": 0.025 },
          "modalities": { "input": ["text", "image", "audio", "video", "pdf"], "output": ["text"] }
        },
        "gemini-claude-sonnet-4-5-thinking-high": {
          "id": "gemini-claude-sonnet-4-5-thinking",
          "name": "Claude Sonnet 4.5 (High Thinking)",
          "release_date": "2025-11-18",
          "reasoning": true,
          "limit": { "context": 200000, "output": 64000 },
          "cost": { "input": 3, "output": 15, "cache_read": 0.3 },
          "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
          "options": { "thinkingConfig": { "thinkingBudget": 32000, "includeThoughts": true } }
        },
        "gemini-claude-sonnet-4-5-thinking-medium": {
          "id": "gemini-claude-sonnet-4-5-thinking",
          "name": "Claude Sonnet 4.5 (Medium Thinking)",
          "release_date": "2025-11-18",
          "reasoning": true,
          "limit": { "context": 200000, "output": 64000 },
          "cost": { "input": 3, "output": 15, "cache_read": 0.3 },
          "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
          "options": { "thinkingConfig": { "thinkingBudget": 16000, "includeThoughts": true } }
        },
        "gemini-claude-sonnet-4-5-thinking-low": {
          "id": "gemini-claude-sonnet-4-5-thinking",
          "name": "Claude Sonnet 4.5 (Low Thinking)",
          "release_date": "2025-11-18",
          "reasoning": true,
          "limit": { "context": 200000, "output": 64000 },
          "cost": { "input": 3, "output": 15, "cache_read": 0.3 },
          "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
          "options": { "thinkingConfig": { "thinkingBudget": 4000, "includeThoughts": true } }
        },
        "gemini-claude-opus-4-5-thinking-high": {
          "id": "gemini-claude-opus-4-5-thinking",
          "name": "Claude Opus 4.5 (High Thinking)",
          "release_date": "2025-11-24",
          "reasoning": true,
          "limit": { "context": 200000, "output": 64000 },
          "cost": { "input": 5, "output": 25, "cache_read": 0.5 },
          "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
          "options": { "thinkingConfig": { "thinkingBudget": 32000, "includeThoughts": true } }
        },
        "gemini-claude-opus-4-5-thinking-medium": {
          "id": "gemini-claude-opus-4-5-thinking",
          "name": "Claude Opus 4.5 (Medium Thinking)",
          "release_date": "2025-11-24",
          "reasoning": true,
          "limit": { "context": 200000, "output": 64000 },
          "cost": { "input": 5, "output": 25, "cache_read": 0.5 },
          "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
          "options": { "thinkingConfig": { "thinkingBudget": 16000, "includeThoughts": true } }
        },
        "gemini-claude-opus-4-5-thinking-low": {
          "id": "gemini-claude-opus-4-5-thinking",
          "name": "Claude Opus 4.5 (Low Thinking)",
          "release_date": "2025-11-24",
          "reasoning": true,
          "limit": { "context": 200000, "output": 64000 },
          "cost": { "input": 5, "output": 25, "cache_read": 0.5 },
          "modalities": { "input": ["text", "image", "pdf"], "output": ["text"] },
          "options": { "thinkingConfig": { "thinkingBudget": 4000, "includeThoughts": true } }
        }
      }
    }
  }
}
```

## Debugging Antigravity Requests
[](https://github.com/shekohex/opencode-google-antigravity-auth#debugging-antigravity-requests)
Use OpenCode's built-in logging to debug Antigravity requests:
```
opencode --log-level DEBUG --print-logs
```

Or just set the log level and check the log files:
```
opencode --log-level DEBUG
```

Log files are stored in `~/.local/share/opencode/logs/` (or `$XDG_DATA_HOME/opencode/logs/`).
## How to test with Opencode
[](https://github.com/shekohex/opencode-google-antigravity-auth#how-to-test-with-opencode)
  1. Install plugin locally as above or via registry.
  2. Run `opencode auth login` and pick **Antigravity**.
  3. Complete browser flow (or copy/paste if headless).
  4. Issue a Gemini model request, e.g. `opencode run -m google/gemini-2.5-flash -p "hello"` or `opencode run -m google/gemini-3-pro-high -p "solve this"`.
  5. Verify responses succeed and no API key prompt appears.


## Troubleshooting
[](https://github.com/shekohex/opencode-google-antigravity-auth#troubleshooting)
### Image Support
[](https://github.com/shekohex/opencode-google-antigravity-auth#image-support)
To enable image input for Antigravity models in OpenCode, you must add the `modalities` configuration to your model definitions in `opencode.json`:
```
{
  "provider": {
    "google": {
      "models": {
        "gemini-3-pro-high": {
          "modalities": {
            "input": ["text", "image"],
            "output": ["text"]
          }
        },
        "claude-sonnet-4-5-thinking": {
          "modalities": {
            "input": ["text", "image"],
            "output": ["text"]
          }
        }
      }
    }
  }
}
```

Without the `modalities.input` array containing `"image"`, OpenCode will reject image inputs with the error: `"this model does not support image input"`. This applies to both Gemini and Claude models accessed through Antigravity.
**Note:** The example config in this README already includes proper `modalities` configuration for all models.
### Tool Name Compatibility with Gemini
[](https://github.com/shekohex/opencode-google-antigravity-auth#tool-name-compatibility-with-gemini)
Gemini API requires tool names to match the pattern `^[a-zA-Z_][a-zA-Z0-9_-]*$`, meaning they cannot start with numbers. The plugin automatically sanitizes tool names by prepending `t_` to any tool name that starts with a digit.
For example:
  * `21st-dev-magic_component_builder` → `t_21st-dev-magic_component_builder`


This sanitization is transparent and automatic. However, if you encounter tool-related errors with Gemini models, you can disable problematic MCP servers in your config:
```
{
  "provider": {
    "google": {
      "models": {
        "gemini-3-pro-high": {
          "tools": {
            "21st-dev-magic_*": false
          }
        }
      }
    }
  }
}
```

### Compatibility with `opencode-skills`
[](https://github.com/shekohex/opencode-google-antigravity-auth#compatibility-with-opencode-skills)
The [`opencode-skills`](https://github.com/malhashemi/opencode-skills) plugin is currently **incompatible** with this plugin. Using them together may cause `invalid_request_error` failures, especially with Claude thinking models, due to conflicts in message history handling.
**Recommended Alternative:** We suggest using [openskills](https://github.com/numman-ali/openskills) instead, which provides similar functionality without these compatibility issues.
## Credits
[](https://github.com/shekohex/opencode-google-antigravity-auth#credits)
This project is based on:
  * [opencode-gemini-auth](https://github.com/jenslys/opencode-gemini-auth) - Original Gemini OAuth implementation by [@jenslys](https://github.com/jenslys)
  * [CLIProxyAPI](https://github.com/router-for-me/CLIProxyAPI) - Reference implementation for Antigravity API translation
  * Special thanks to [Mirrowel](https://github.com/Mirrowel) for identifying Gemini/Claude tool behavior fixes and mitigation strategies.


## Cross-Model Conversations
[](https://github.com/shekohex/opencode-google-antigravity-auth#cross-model-conversations)
You can switch between Claude and Gemini models within the same conversation session. The plugin handles the complexities of thinking block signatures with **family-independent caching**.
### How It Works
[](https://github.com/shekohex/opencode-google-antigravity-auth#how-it-works-2)
When models generate "thinking" blocks (extended reasoning), each provider signs them cryptographically. These signatures are provider-specific and cannot be validated across providers. The plugin solves this with:
  1. **Family-Independent Cache** : Signatures are cached per model family (`claude` or `gemini`), preventing cross-contamination
  2. **Response Caching** : When a model responds with thinking, the signature is cached in that family's namespace
  3. **Request Restoration** : When sending a request, thinking blocks are restored from the same family's cache
  4. **Foreign Removal** : Thinking blocks not found in the current family's cache are removed (they're from another family)


### Behavior Summary
[](https://github.com/shekohex/opencode-google-antigravity-auth#behavior-summary)
Transition | Thinking Preserved | Notes  
---|---|---  
Claude → Claude | ✅ All Claude thinking | Signatures restored from Claude cache  
Gemini → Gemini | ✅ All Gemini thinking | Signatures restored from Gemini cache  
Claude → Gemini | ❌ Claude thinking removed | Not in Gemini's cache  
Gemini → Claude | ❌ Gemini thinking removed | Not in Claude's cache  
### Multi-Turn Example
[](https://github.com/shekohex/opencode-google-antigravity-auth#multi-turn-example)
```
Turn 1: Claude (thinking) → "Let me analyze this..." [cached in Claude family]
Turn 2: Switch to Gemini  → Claude's thinking removed, only text preserved
Turn 3: Gemini (thinking) → "Processing..." [cached in Gemini family]  
Turn 4: Switch to Claude  → Gemini's thinking removed, Claude Turn 1 restored ✅
Turn 5: Switch to Gemini  → Claude's thinking removed, Gemini Turn 3 restored ✅

```

### Key Points
[](https://github.com/shekohex/opencode-google-antigravity-auth#key-points)
  * **Family isolation** : Claude and Gemini thinking are cached separately
  * **No cross-contamination** : Impossible for signatures to leak between families
  * **Conversation text preserved** : Only thinking blocks are removed; actual response text flows through normally
  * **Same-provider continuity** : Each family maintains its own thinking history across model switches


## About
Antigravity (Google) auth plugin for opencode 
[www.npmjs.com/package/opencode-google-antigravity-auth](https://www.npmjs.com/package/opencode-google-antigravity-auth "https://www.npmjs.com/package/opencode-google-antigravity-auth")
### Topics
[ opencode ](https://github.com/topics/opencode "Topic: opencode") [ gemini ](https://github.com/topics/gemini "Topic: gemini") [ antigravity ](https://github.com/topics/antigravity "Topic: antigravity") [ opencode-plugins ](https://github.com/topics/opencode-plugins "Topic: opencode-plugins")
### Resources
[ ](https://github.com/shekohex/opencode-google-antigravity-auth#readme-ov-file)
### License
[ ](https://github.com/shekohex/opencode-google-antigravity-auth#MIT-1-ov-file)
###  Uh oh! 
There was an error while loading. [Please reload this page](https://github.com/shekohex/opencode-google-antigravity-auth).
[Activity](https://github.com/shekohex/opencode-google-antigravity-auth/activity)
### Stars
[**91** stars](https://github.com/shekohex/opencode-google-antigravity-auth/stargazers)
### Watchers
[**1** watching](https://github.com/shekohex/opencode-google-antigravity-auth/watchers)
### Forks
[**3** forks](https://github.com/shekohex/opencode-google-antigravity-auth/forks)
[ Report repository ](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fshekohex%2Fopencode-google-antigravity-auth&report=shekohex+%28user%29)
##  [Releases 21](https://github.com/shekohex/opencode-google-antigravity-auth/releases)
[ v0.2.11 Latest  Dec 26, 2025 ](https://github.com/shekohex/opencode-google-antigravity-auth/releases/tag/v0.2.11)
[+ 20 releases](https://github.com/shekohex/opencode-google-antigravity-auth/releases)
##  [Packages 0](https://github.com/users/shekohex/packages?repo_name=opencode-google-antigravity-auth)
No packages published   

## Languages
  * TypeScript 98.0%
  * Shell 2.0%


## Footer
[ ](https://github.com) © 2025 GitHub, Inc. 
### Footer navigation
  * [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
  * [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
  * [Security](https://github.com/security)
  * [Status](https://www.githubstatus.com/)
  * [Community](https://github.community/)
  * [Docs](https://docs.github.com/)
  * [Contact](https://support.github.com?tags=dotcom-footer)
  * Manage cookies 
  * Do not share my personal information 


